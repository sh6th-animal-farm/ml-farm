<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.animalfarm.mlf.domain.carbon.CarbonRepository">

  	<!-- 전체 조회 -->
	<select id="selectAll"
	        resultType="com.animalfarm.mlf.domain.carbon.dto.CarbonListDTO">
	  SELECT
	    cp.cp_id               AS cpId,
	    cp.project_id          AS projectId,
	    cp.cp_title            AS cpTitle,
	    cp.cp_type             AS category,
	    cp.cp_price            AS cpPrice,
	    cp.cp_amount           AS cpAmount,
	    cp.product_certificate AS productCertificate,
	    cp.vintage_year        AS vintageYear,
	    cp.cp_detail           AS cpDetail,
	    pi.image_url           AS thumbnailUrl
	  FROM carbon_products cp
	  LEFT JOIN projects p
	         ON cp.project_id = p.project_id
	  LEFT JOIN project_images pi
	         ON pi.project_id = p.project_id
	        AND pi.is_thumbnail = true
	  ORDER BY cp.cp_id DESC
	</select>
	
	<!-- 조건 조회 -->
	<select id="selectByCondition"
	        parameterType="string"
	        resultType="com.animalfarm.mlf.domain.carbon.dto.CarbonListDTO">
	
	  SELECT
	    cp.cp_id               AS cpId,
	    cp.project_id          AS projectId,
	    cp.cp_title            AS cpTitle,
	    cp.cp_type             AS category,
	    cp.cp_price            AS cpPrice,
	    cp.cp_amount           AS cpAmount,
	    cp.product_certificate AS productCertificate,
	    cp.vintage_year        AS vintageYear,
	    cp.cp_detail           AS cpDetail,
	    pi.image_url           AS thumbnailUrl
	  FROM carbon_products cp
	  LEFT JOIN projects p
	         ON cp.project_id = p.project_id
	  LEFT JOIN project_images pi
	         ON pi.project_id = p.project_id
	        AND pi.is_thumbnail = true
	
	  <where>
	    <if test="category != null and category != ''">
	      AND cp.cp_type = #{category}
	    </if>
	  </where>
	
	  ORDER BY cp.cp_id DESC
	</select>
</mapper>
